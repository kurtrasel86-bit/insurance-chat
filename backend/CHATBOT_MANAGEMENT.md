# Управление чат-ботом

## Обзор системы

Система управления чат-ботом позволяет легко улучшать качество ответов бота, добавляя инструкции и примеры в специальные файлы.

## Структура файлов

```
backend/
├── CHATBOT_INSTRUCTIONS.md    # Общие принципы и инструкции
├── CHATBOT_PROMPTS.md         # Конкретные промпты и примеры
├── update-chatbot-prompt.js   # Скрипт обновления
└── src/modules/ai/ai.service.ts # Файл с системным промптом
```

## Как использовать

### 1. Редактирование инструкций

#### CHATBOT_INSTRUCTIONS.md
Содержит общие принципы работы бота:
- Стиль общения
- Структура ответов
- Типы страховых продуктов
- Компании и их особенности
- Частые вопросы и ответы

#### CHATBOT_PROMPTS.md
Содержит конкретные промпты и примеры:
- Системный промпт (основной)
- Примеры хороших ответов
- Примеры плохих ответов
- Шаблоны ответов
- Специфические сценарии

### 2. Обновление бота

После редактирования файлов запустите:

```bash
# Обновить промпт бота
npm run chatbot:update

# Показать справку
npm run chatbot:help
```

### 3. Перезапуск сервера

После обновления промпта перезапустите сервер:

```bash
npm run start:dev
```

## Примеры улучшений

### Добавление нового типа страхования

1. **В CHATBOT_INSTRUCTIONS.md:**
```markdown
### Новый тип страхования
- **Название** - описание
- **Что покрывает** - список рисков
- **Стоимость** - примерные тарифы
- **Компании** - кто предлагает
```

2. **В CHATBOT_PROMPTS.md:**
```markdown
### Вопрос: "Нужна страховка [тип]"

**Хороший ответ:**
```
[Пример правильного ответа]
```
```

3. **Обновить бота:**
```bash
npm run chatbot:update
```

### Улучшение ответов на конкретный вопрос

1. **Найти проблемный ответ** в логах или тестах
2. **Добавить в CHATBOT_PROMPTS.md:**
```markdown
### [Дата] - Улучшение ответов по [теме]
**Проблема:** [Описание проблемы]
**Решение:** [Конкретные инструкции]
**Пример:** [Пример правильного ответа]
```

3. **Обновить системный промпт** в CHATBOT_PROMPTS.md
4. **Запустить обновление:**
```bash
npm run chatbot:update
```

## Мониторинг качества

### Логи ответов
Проверяйте логи сервера для анализа ответов бота:
```bash
# В логах ищите:
# - "AI Response:" - ответы бота
# - "User message:" - вопросы пользователей
```

### Тестирование
Регулярно тестируйте бота с различными вопросами:
- Простые вопросы о стоимости
- Сложные индивидуальные случаи
- Вопросы о конкретных продуктах
- Жалобы и нестандартные ситуации

## Рекомендации

### ✅ Что делать хорошо:
- Регулярно обновлять инструкции
- Добавлять конкретные примеры
- Тестировать изменения
- Анализировать обратную связь
- Документировать изменения

### ❌ Чего избегать:
- Слишком общих инструкций
- Противоречивых указаний
- Игнорирования обратной связи
- Редких обновлений
- Сложных технических терминов

## Автоматизация

### Скрипт обновления
`update-chatbot-prompt.js` автоматически:
- Читает инструкции из файлов
- Извлекает системный промпт
- Обновляет ai.service.ts
- Показывает результат

### Интеграция с CI/CD
Можно добавить автоматическое обновление при изменении файлов:
```bash
# В package.json
"scripts": {
  "watch:chatbot": "nodemon --watch CHATBOT_*.md --exec 'npm run chatbot:update'"
}
```

## Поддержка

При возникновении проблем:
1. Проверьте синтаксис в файлах инструкций
2. Убедитесь, что системный промпт корректный
3. Проверьте логи сервера
4. Перезапустите сервер после изменений

---

**Важно:** Все изменения в инструкциях должны быть протестированы перед использованием в продакшене!
