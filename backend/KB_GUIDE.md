# üìö Knowledge Base (RAG) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –ß—Ç–æ —ç—Ç–æ?

Knowledge Base —Å RAG (Retrieval-Augmented Generation) –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–æ—Ç—É –¥–∞–≤–∞—Ç—å —Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ —Å—Ç—Ä–∞—Ö–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–∞—Ö.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. **–î–æ–∫—É–º–µ–Ω—Ç—ã —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —á–∞–Ω–∫–∏** (—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –ø–æ 500 —Å–∏–º–≤–æ–ª–æ–≤)
2. **–ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∏** —á–µ—Ä–µ–∑ OpenAI –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
3. **–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –∏—â—É—Ç—Å—è –ø–æ—Ö–æ–∂–∏–µ —á–∞–Ω–∫–∏
4. **AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç** –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

## API Endpoints

### üìù –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç

```http
POST /kb/documents
Content-Type: application/json

{
  "companyCode": "PICC",
  "productCode": "TRAVEL_ANNUAL",
  "title": "–ì–æ–¥–æ–≤–æ–π —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–ª–∏—Å",
  "content": "–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞...",
  "fileUrl": "https://example.com/doc.pdf",
  "sourceUrl": "https://picc.com/products/travel",
  "version": "2.0"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "docId": "uuid-here",
  "chunksCount": 5
}
```

### üìã –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

```http
GET /kb/documents?companyCode=PICC&productCode=TRAVEL_ANNUAL
```

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "id": "uuid",
    "companyCode": "PICC",
    "productCode": "TRAVEL_ANNUAL",
    "title": "–ì–æ–¥–æ–≤–æ–π —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–ª–∏—Å",
    "fileUrl": "...",
    "sourceUrl": "...",
    "version": "2.0",
    "createdAt": "2025-01-01T00:00:00Z",
    "_count": {
      "chunks": 5
    }
  }
]
```

### üîç –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π

```http
POST /kb/search
Content-Type: application/json

{
  "query": "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞?",
  "companyCode": "CPIC",
  "limit": 3
}
```

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "text": "–ü—Ä–µ–º–∏—É–º –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –ø–æ–ª–∏—Å CPIC - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –∑–¥–æ—Ä–æ–≤—å—è...",
    "score": 0.87,
    "docTitle": "–ü—Ä–µ–º–∏—É–º –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ CPIC",
    "companyCode": "CPIC",
    "productCode": "MEDICAL_PREMIUM"
  }
]
```

### üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç

```http
DELETE /kb/documents/:id
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### PowerShell

#### –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç:
```powershell
$body = @{
  companyCode = "PICC"
  productCode = "TRAVEL_ANNUAL"
  title = "–ì–æ–¥–æ–≤–æ–π —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–ª–∏—Å"
  content = "–ì–æ–¥–æ–≤–æ–π —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–ª–∏—Å PICC –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç..."
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:3000/kb/documents" -Method Post -Body $body -ContentType "application/json"
```

#### –ü–æ–∏—Å–∫:
```powershell
$body = @{
  query = "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –¥–ª—è —Ç—É—Ä–∏—Å—Ç–æ–≤?"
  limit = 3
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:3000/kb/search" -Method Post -Body $body -ContentType "application/json"
```

### Curl

#### –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç:
```bash
curl -X POST http://localhost:3000/kb/documents \
  -H "Content-Type: application/json" \
  -d '{
    "companyCode": "PICC",
    "productCode": "TRAVEL_ANNUAL",
    "title": "–ì–æ–¥–æ–≤–æ–π —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–ª–∏—Å",
    "content": "–ì–æ–¥–æ–≤–æ–π —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–ª–∏—Å PICC –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç..."
  }'
```

#### –ü–æ–∏—Å–∫:
```bash
curl -X POST http://localhost:3000/kb/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –¥–ª—è —Ç—É—Ä–∏—Å—Ç–æ–≤?",
    "limit": 3
  }'
```

## –ö–∞–∫ –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç RAG

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –±–æ—Ç—É, —Å–∏—Å—Ç–µ–º–∞:

1. **–ò—â–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã** –ø–æ –∑–∞–ø—Ä–æ—Å—É
2. **–ü–µ—Ä–µ–¥–∞–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ AI**
3. **AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç** —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
4. **–ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–µ—Ç** - –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–≤—è–∑–∞—Ç—å—Å—è —Å –∞–≥–µ–Ω—Ç–æ–º

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –≥–æ–¥–æ–≤–∞—è —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞?"

**–°–∏—Å—Ç–µ–º–∞:**
1. –ò—â–µ—Ç –≤ KB –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫—É—é —Å—Ç—Ä–∞—Ö–æ–≤–∫—É
2. –ù–∞—Ö–æ–¥–∏—Ç "–û–°–ê–ì–û –°–û–ì–ê–ó - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∞–≤—Ç–æ—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ" (–°–û–ì–ê–ó)
3. AI –æ—Ç–≤–µ—á–∞–µ—Ç: "–û–°–ê–ì–û –æ—Ç –°–û–ì–ê–ó —Å—Ç–æ–∏—Ç –æ—Ç 1,200 —Ä—É–±–ª–µ–π –≤ –≥–æ–¥..."

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π

### –ß–µ—Ä–µ–∑ Prisma Studio:
```powershell
npm run prisma:studio
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ http://localhost:5555 –≥–¥–µ –º–æ–∂–Ω–æ:
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∞–Ω–∫–∏
- –£–¥–∞–ª—è—Ç—å –∑–∞–ø–∏—Å–∏

### –ß–µ—Ä–µ–∑ API:

–°–º. –ø—Ä–∏–º–µ—Ä—ã –≤—ã—à–µ.

## –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–ü–æ—Å–ª–µ `npm run prisma:seed` –≤ –ë–î –±—É–¥—É—Ç:

1. **PICC - –¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–ª–∏—Å** (TRAVEL_ANNUAL)
2. **CPIC - –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞** (MEDICAL_PREMIUM)
3. **Ping An - –ê–≤—Ç–æ—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ** (AUTO_STANDARD)
4. **PICC - –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã** (PROPERTY_HOME)
5. **CPIC - –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞** (BUSINESS_SME)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

–î–ª—è —Ä–∞–±–æ—Ç—ã –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –Ω—É–∂–µ–Ω **OpenAI API –∫–ª—é—á** –≤ `.env`:

```env
OPENAI_API_KEY="sk-your-api-key"
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å: `text-embedding-3-small` (1536 –∏–∑–º–µ—Ä–µ–Ω–∏–π)

### –ë–µ–∑ API –∫–ª—é—á–∞:

–°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –ø–æ–∏—Å–∫ –±—É–¥–µ—Ç –±–∞–∑–æ–≤—ã–º (–≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å score=0).
–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å –±–µ–∑ –∫–ª—é—á–∞.

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤:

–≠–º–±–µ–¥–¥–∏–Ω–≥–∏ —á–∞–Ω–∫–æ–≤ –∫–µ—à–∏—Ä—É—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞.

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:

–î–ª—è –±–æ–ª—å—à–∏—Ö –±–∞–∑ –∑–Ω–∞–Ω–∏–π (1000+ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î (Pinecone, Weaviate, Qdrant)
- –•—Ä–∞–Ω–∏—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

## –£–ª—É—á—à–µ–Ω–∏—è (TODO)

- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PDF/DOCX —Ñ–∞–π–ª–æ–≤
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- [ ] –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î –≤–º–µ—Å—Ç–æ in-memory –ø–æ–∏—Å–∫–∞
- [ ] –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π, –Ω–µ–º–µ—Ü–∫–∏–π)
- [ ] –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π




